<?php
//© 2022 Martin Peter Madsen
namespace MTM\QR\Models\V1;

require_once(MTM_QR_BASE_PATH."Vendors/kazuhikoarase/qrcode.php");

abstract class Base
{
	public function getUrl($code)
	{
		$qr = \QRCode::getMinimumQRCode("https://qr.datacamo.net/?invtag=".$code, QR_ERROR_CORRECT_LEVEL_M);
		$im = $qr->createImage(5, 0);
		
		$width	= 165;
		$height = 360;
		$qrSize	= 145;
		
		$newImg = imagecreatetruecolor($width, $height);
		imagefill($newImg, 0, 0, imagecolorallocate($newImg, 255, 255, 255)); 
		imagecopyresampled($newImg, $im, round(($width-145) / 2), 105, 0, 0, $qrSize, $qrSize, $qrSize, $qrSize);
	
		$font = "/usr/share/fonts/dejavu/DejaVuSans-BoldOblique.ttf";
		imagettftext($newImg, 18, 0, 18, 50, imagecolorallocate($newImg, 0, 0, 0), $font, "Lionstripe");
		imagettftext($newImg, 18, 0, 18, 80, imagecolorallocate($newImg, 0, 0, 0), $font, "Networks");
		imagettftext($newImg, 18, 0, 40, 285, imagecolorallocate($newImg, 0, 0, 0), $font, $code);
		$newImg = imagerotate($newImg, 90, 0);
		
		ob_start();
		imagepng($newImg);
		$buffer = base64_encode(ob_get_clean());
		imagedestroy($im);
		imagedestroy($newImg);
		if(ob_get_length() > 0) {
			ob_clean();
		}

		return $buffer;
// 		$tag	= "<img src=\"data:image/png;base64,".base64_encode($buffer)."\">";
		
// 		echo $tag;

	}
	public function printCodes()
	{
		
		$oldCodes	= "ACXWB
GZRSB
XEYZE
TAPXE
AYZDP
DDZTT
UGWCU
VATCV
FYFAX
BRZRC
UACUU
DGGHY
EPUVC
HUURG
TSUZC
AVSHH
AUTWS
AEZTV
ZATHU
ZHPAU
HCACE
YTXCR
FTEWB
RAGAZ
YXTAC
WSDAD
CVZSC
UEXVC
UDUFD
BAXGA
XYFZH
UDCYD
ZTVFE
EGCUG
YXGZY
FEVUY
TYCXY
ADVRA
YUUCB
BSSYZ
SGFDH
TUZAT
DHBAD
WPARC
DGPAG
TZRVB
CCWAE
XXECG
PUDDD
HZPPB
FXUVW
TVAAE
WDXCY
UCEBD
UHEFH
FCBYZ
EXEBR
APRPC
CHDZP
VRGVG
HPWAZ
ZYXVY
RAZUS
CEHRB
FECYC
FGWAZ
PHDUD
YEFCY
UATUF
RZGRP
GTDVG
YVYBB
BRSGS
BHHHH
GZSFZ
DEYBW
YRRDT
XGVZP
GRWWF
XUSXC
AETDV
GPTFF
YDFDP
EZACT
EGPHX
YFCSZ
WTPYD
XGDEW
BYUXE
FDADE
FHBUC
CARHW
ABCWS
VCWAB
YEDVC
RRBHS
DBYBX
XXDFY
UZVDS
HZWUA
CVHRB
VHUZH
TSVHS
PASCA
HFRPA
FVEBF
BTAXH
SSGYC
WCRPZ
FTFCH
UWRYZ
SAVUR
YAERZ
EHZWX
XGGDH
BAXDU
FPWWD
UDUUV
PSTCC
DSWGS
YFHCA
RFHCG
TVRFE
DUPFX
TBVDH
YYFAB
WHVAU
YXSYS
PZHHZ
FSCRG
FDYHW
UFZGT
FEUUU
PCXER
VWCTG
GZVUE
EWWBW
TRXDY
BVGER
UYXSH
ZFTGA
URCHT
UDZHH
HRXXY
BEDPD
HGHFP
RFAHD
HXFWU
TSRSF
HFGSG
SBVFR
BGUFR
HHDAR
FGEHW
PVCFP
ZRPPZ
UXVWZ
AYXFS
BFRZU
XVDWH
FGBFU
ECTZF
DXESE
DGPCV
WGZCE
PFFXS
TFSVG
UHHPX
XUBEH
PEWGC
ZDXRA
XESCG
DRAPU
UBFAA
SBTSV
BAYUU
CEACT
XUHAX
GSHEB
ZSGVA
ASZWX
AHUBH
ZGZBD
HEBPW
GFDPC
RDGVY
FAFVC
BAFSG
GGHPX
DSTVE
UBXHU
HDHVA
DRBVG
XCWPZ
UEWTF
HFTYC
DFGHF
SWCYW
EHSBF
GCRUF
HXHYT
DERUS
PWTPH
YWTTY
CSAYR
RZVCX
WATWS
YYSBG
YBHYY
XEECF
BSZHE
PFVDG
PTYCC
RHPPE
FCYFS
XEUSV
TAWBH
DYEVF
VPSHX
CZPPB
ZARYH
FPPWW
ECVAX
HVYTZ
FHFDC
AUPZE
UACYX
HYUEP
YRGGA
VPAYF
EDHVS
YXZHW
YXPZU
ZCPSV
BSHTU
RFZVT
RYAGT
GASYW
BADET
GSXHC
GAXTU
EBSXG
REWHX
DXGSG
PDWFP
SZDRP
TFHCW
EDBHA
AZUYF
SEHDD
GXHAW
CHBTU
GRPVS
WDXCT
DCZRW
VZCYC
CHZAS
HZGWF
CSXRU
YCZTV
DXTVR
CYEVV
PDURA
VSUCF
XEPEX
HZDWD
URXSA
VGUVY
CYFZT
AEPGA
CFSGR
AAPTC
RFRSE
HEPEZ
VBCRC
SCDAC
STVTT
CAWRF
GDBGZ
CGGFY
EHWSV
HBXTW
SSCAD
ZSWUT
GBATZ
SGTYW
HSWWA
TEEVD
DRWVH
ADGCV
UTBSV
HTWHY
WWDBD
TDFSS
YWCGD
XURVC
SZPHG
DUTYP
UFHPS
GZPFB
RUYFR
FFXZX
WWZFB
XDGRW
FXPAF
RRUVW
DBFPS
XCRPG
SFTGP
WVFPH
THGRS
DUXAT
RFBHF
DZZSE
BXAVB
VAAUP
BBEWU
WSXVV
PBCFS
SHYVW
HXWDP
YBXDP
HGRAF
GRUHD
ZUZDT
RVRVE
PGABD
WVEZS
CXRBA
VFGED
PSUTG
DYWCC
FTTTW
EGRAB
DZFUB
UDGPP
UWSXE
HRPHR
BEHWD
WRDTZ
USBGT
URVXZ
YXWGA
AUAAZ
DVVUT
CDWVD
SSHAT
ZUSFU
VBGTC
EWYHE
YGCAW
PDBSY
VHGHB
SPWAZ
XEAPH
ARUUA
AXGWY
STBHF
ABXVZ
ZBWWR
RARTZ
DVCHE
WWHYR
SHHSR
AGHEV
YXFZS
UTUEA
XBREW
FFGTY
GYYRA
BZBUD
CEGEX
YUCRB
TZPVX
EUZBP
WBZAF
GRHXB
ZUCPD
EBUEW
RBZCZ
ACPPH
ZVGTW
GHBZR
BXCDB
FCSDC
FHESC
EEXUZ
ESCYB
YDPZB
UHRAH
RXWUV
WTUPP
ARSHW
ZXUVW
DARYP
PCVCD
FRPFB
DWSSU
EZCAH
YHACA
RSFGX
RVXAD
UBHHD
GVRYP
ZZTDC
WZTBC
AFPRB
VAYSX
GZSXE
PVZXW
HHRYW
XVHCZ
BHAAW
PHYEE
VUBDY
HZEBA
DVCCA
HEHXP
AWVHV
FVXGR
HFBUC
SRVEZ
WRARG
YRERG
TWFHC
CPDPC
RBRSH
XBECC
XGWPC
AHVPZ
TBZCX
ETRXH
SHPSW
AZHSX
CUAUY
HYFFW
AWHYD
UTEPP
EHZYE
BDRRR
GSEWD
PHGPU
CAXBT
AXAFY
AWTXR
VFPES
CZBCB
PVYDW
XXDVW
FCURU
AFSSR
UVVGV
EVHDH
PVUVA
TFZPD
CHGWR
CGXZR
AZSPV
CZEUC
PUZED
UYEUF
YGUBT
PCWXY
VAUDX
EGURR
HWXAV
DWZAB
GZVPH
BFAEX
YBWHU
DHRCA
HRDZY
BAAWT
GXXUZ
ESPGZ
DVDZZ
FAWWT
BGGDB
ESGEE
RCBWR
SXHBV
FAUPH
TCYXX
RWGTX
PSUCZ
ABZZE
GDZTT
UDTVZ
CVYZT
PXADE
BYRXP
CBCHC
GGWWA
RCGAE
RXAVY
GGDUZ
XFRRG
EDUHS
PSHGP
ZTZTB
BACBA
GXAZX
WGHYV
RGFYF
SRXXU
UCAZE
UDRCU
PAERA
YFZGW
PSYDZ
EHHRE
UZDAZ
DYWSS
FBPGT
GBCWE
CDETS
GWFTU
EADBD
RUZDG
PCWVR
GPTZH
ZZHCP
ZCAWH
SHSRE
CXPSE
BPHAZ
SYBEP
WUAEE
YHVVR
EARHV
SYAAV
RXYPU
DCYCS
BDFGR
YBGDS
UZSDX
FPPDB
GRBXG
YCHZT
WCRXF
FYBGE
BYBZD
ZWEFD
YEFRS
VHUWZ
VADFG
CHBPP
ZBSCC
APPVZ
ZFCVU
PYGCU
ZSGPX
WSPTA
SXRPV
ASFST
VEACV
PUWTH
SDXWW
BYAFS
RWSZW
EWTFZ
YGPFR
UGCSG
UACZY
FCURZ
VDUHV
WZAPD
UCAXR
DZBDA
YYXRR
ZPHAG
PVUGA
FRUCY
PHBVZ
FUWTV
TVGGP
ATAGP
WTXUB
ZRTUB
FFBHH
WPWAG
TPYHS
FTTDR
CYFYB
CGERU
GVTHV
WDYSD
XZRBS
BUUBT
HCZTZ
ZPVFY
USVTH
GZTPS
BUVCD
AZHAH
VWAEF
WYVBW
WWZWG
ZDTYZ
YDCXV
WTATC
BFZVY
TTZGV
YYDXZ
SBZXX
CWPFB
AYYWR
RUZHU
EBADY
BERTB
FFHFG
PDVCU
GBDRP
GGWCG
HRZVB
CUGDH
DADCV
VVTWW
PBSES
ACZCY
PHYAT
REZSC
UYCBE
YFAYX
BYGUS
AGYCU
CFYEG
ZGFCG
DPSXV
STRRD
VGWRS
HWGFA
PDXPY
ZCACC
EACHS
RGUAH
AYUFT
GADHD
SRGVH
SSREP
GFZEY
CTHGZ
PZYXX
DWGGR
ZDTUV
WFTUT
EHYFA
YFYCC
AEEVW
GPVYS
AFRPV
XUDWZ
ZTADZ
FFTDG
AYARE
EXEHA
EXPAG
XPVZC
PXBPH
DVRDG
FCRYS
PFCGH
FHSRA
ECFYD
YFSXV
HPRTS
XXTHH
CHDGE
WFFUE
EEZDE
HHVFB
HZDXF
SATYE
STTCP
ZBHZR
VPPCH
RBUSP
EEDSP
SVFRE
AFPCH
SEDAD
UUHTP
HXHES
YZEFE
XPCCC
VAGTH
TXXDS
BHFTP
XXBPF
SHGSS
WCPXE
AFHBD
YWHSX
CTXRC
ZHDUG
TTDZH
FPRCB
TFZFD
AHSGC
FVSTX
GZSFU
CZCFB
ZVHAY
HTPSC
UXXYC
BBXHG
EFTTG
HRCWC
XECFT
CTAGW
AWEES
ZXHPZ
STAUX
BFDFA
CCCYA
UUZVR
GVWTC
RHHXA
XDYTZ
WCGGS
UZSVE
URGXV
ZEDUP
ZSBYS
ZDABU
SSZPE
UFUCG
HEGRY
DFUFP
WETZE
FUSEP
PBBAH
AUDFU
HYWHG
HVCTE
FDGRE
XAFBP
VSASE
VTZPY
XYZUP
DDSWW
WPHBE
DXDPW
AVPTD
RDRSU
DCEYV
WVZBR
BVFGU
SGYGG
FURHW
XXGVD
HBFBD
ZVRPD
CRHES
VHDZW
SFZWS
GUTWT
YFXSR
XDYUX
TGWUA
CSEZG
BSUCB
ZHUZT
BBUYS
FWGBY
FXRXC
ESTDY
FCPDV
DWSPY
ZCUEB
ZUZYT
EEUXE
UPSVY
PEPBT
XBBBT
BWCYU
DZFRC
AUTUU
ECBSE
TBCZS
ZBSWD
CPCYW
HRAEV
STVVB
UWTAV
CDXDD
EVCFC
VVVXF
RWARA
HZBWE
FCYYU
BTPXY
FRUXP
GPWBW
XDCDF
XVSZU
XUEYY
SAXAY
GVBEX
THHBZ
VVBCF
GVYRA
CAPCU
WAPGR
PWXAZ
WHEYA
HUPHZ
FFWTW
WAFSS
XYAEX
ZCZGT
EPVEZ
TGEVD
THYEZ
FDFCR
CFRUS
PBPSU
ARCBB
ZCHBX
YRFWG
TDRRE
ETAZA
DYVTE
DEABA
GSWFP
EZWVD
CBXWZ
UFVCG
XRTHS
FYWUV
PHAYT
XSZHS
HBEYU
SSXVR
XCDAC
ACBRX
CCCWP
YXHRU
CRZRX
FHVEY
HCEWF
BCAWT
VWZFU
ZBBHP
WYWRV
STASU
EFSGR
GZUFW
BGEWB
FXECB
RTGAZ
DWEEP
TTAPX
PEPZD
DURCH
YAFAT
XVHHG
DHHSA
VABZX
ZDDRP
AEACD
GEGRX
ZDSZV
WXPPV
XBBXT
SXHYR
YZXHW
PTDAW
CGBSZ
VAVFY
AZDWY
TGWAF
YGXSY
UWASR
UHZES
HGGSZ
XERRH
CURWX
ZATET
DFHPV
TZBZY
RYDZD
RXXHF
GGTPB
RZVPD
AGHYA
DXVSG
VCXHZ
DCBHV
FHADU
ZDCCH
ATUHC
TUWAS
FVHYW
XVHWC
HERBC
EBBAU
DCZYG
SCAEY
XATFR
EYBEG
AAVAR
SXSZY
ZDXFU
ZXWTU
SZGVD
AVXAW
FUDXV
FSUGG
BXFAE
GSRXY
FZRPA
HAYPU
XDRYH
UXREY
GCVPY
AFHYX
BEUHE
UPXPB
PWCFA
ZDXYH
GFSDU
ZVFCY
ZWBCD
RBHCF
YFEFT
FCBYG
HGGTE
VTGXR
RSAYV
HDHPY
RYVSH
YEGFP
DSWBU
EFHYX
ZTWDC
DUTRV
FRYVU
WEUAH
YWRHH
ZRGCG
VXEZU
ZVGRX
GVSEF
ZVARF
ZHCXZ
CTRZD
SGPSG
DYHSV
GEUGW
SSPED
PWERC
EYAFY
TADDX
EUDDP
GZZHC
TFHBY
ESBAY
EZTGW
VPVWZ
PEXHR
YZCYZ
BZCCP
PDGVU
AGBTA
FPCYA
DPSAC
ZXBWG
UFEPV
RBEST
WEBUU
FSEBU
UETGC
ZDZTH
XTTFB
ZRVWZ
UBZHS
GHEPD
CUTDZ
YUGZV
ADXRW
SZPEH
AXTSS
XYUSP
SRGHR
FFVCR
PRFCZ
UHUAP
CVATX
ZAXYB
RVZWE
CGURU
RSSYU
UPUSY
DUCUF
PHXPS
VDVCP
TSTXU
ESBAX
AGVWE
";
		
		$oldCodes	= array_map("trim", explode("\n", $oldCodes));
		$eCodes		= array();
		foreach ($oldCodes as $oldCode) {
			$eCodes[$oldCode]	= $oldCode;
		}
		
		//https://dac-test-grp.dynamic-data.io:47480/
		//https://54546546:5645654456@dac-test-grp.dynamic-data.io:47380/api/v1/Accounts/Get/BySession
		$mtmBase	= realpath(DD_DAC_BASE_PATH . "../../../MTM") ."/";
		require_once $mtmBase."mtm-qr/Enable.php";
		$done		= false;
		$nCodes		= array();
		$code		= "CTBPE"; //this is next after the 940 was printed
		
		$html	= "";
		$html	.= "<HTML>";
		$html	.= "<BODY>";
		$i=0;
		while ($done === false) {
			if (array_key_exists($code, $eCodes) === false && array_key_exists($code, $nCodes) === false) {
				
				$nCodes[$code]	= $this->getUrl($code);
				$tag	= "<img src=\"data:image/png;base64,".$nCodes[$code]."\">\n";
				$html	.= $tag."\n";
				
				if ($i > 940) {
					$done		= true;
				}
				$i++;
				if ($i % 6 == 0) {
					$html	.= "<br><br>\n";
				}
			}
			$code++;
		}
		$html	.= "</BODY>";
		$html	.= "</HTML>";
		
		echo $html;
		exit();
	}
}